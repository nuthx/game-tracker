generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:../data/core.db"
}

// 设置
model Config {
  id                    Int          @id @default(autoincrement())
  username              String       @unique
  password              String
  psnNpsso              String       @default("")
  psnMonitorFrom        String       @default("")
  psnMonitorTo          String       @default("")
  psnMonitorInterval    String       @default("30")
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt
}

// 平台
model Platform {
  id                Int        @id @default(autoincrement())
  fullName          String     @default("")  // PlayStation 4
  shortName         String     @default("")  // PS4
  type              String     @default("")  // psn
  players           Player[]
  games             Game[]
  playStates        PlayState[]
  records           Record[]
}

// 玩家（基于平台）
model Player {
  id                Int        @id @default(autoincrement())
  playerId          String     @default("")
  name              String     @default("")
  avatar            String     @default("")
  token             String     @default("")
  platformId        Int
  platform          Platform   @relation(fields: [platformId], references: [id])
  records           Record[]
}

// 游戏
model Game {
  id                Int        @id @default(autoincrement())
  gameId            String     @default("")
  title             String     @default("")
  titleSc           String     @default("")
  titleTc           String     @default("")
  titleEn           String     @default("")
  titleJa           String     @default("")
  platform          Platform[]
  description       String     @default("")
  imageGrid         String     @default("")
  imageHero         String     @default("")
  imageLogo         String     @default("")
  imageIcon         String     @default("")
  gameDeveloper     String     @default("")
  gamePublisher     String     @default("")
  releaseDate       DateTime   @default(now())
  userRate          Int        @default(0)
  userStatus        Int        @default(0)  // 1: 想玩, 2: 在玩, 3: 玩过, 4: 抛弃
  userReview        String     @default("")
  records           Record[]
  playStates        PlayState[]
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
}

// 游戏在不同平台的总游玩数据
model PlayState {
  id                Int        @id @default(autoincrement())
  platformId        Int
  platform          Platform   @relation(fields: [platformId], references: [id])
  gameId            Int
  game              Game       @relation(fields: [gameId], references: [id])
  startAt           DateTime   @default(now())
  endAt             DateTime   @default(now())
  playSeconds       Int        @default(0)
}

// 详细的游戏记录
model Record {
  id                Int        @id @default(autoincrement())
  platformId        Int
  platform          Platform   @relation(fields: [platformId], references: [id])
  playerId          Int
  player            Player     @relation(fields: [playerId], references: [id])
  gameId            Int
  game              Game       @relation(fields: [gameId], references: [id])
  startAt           DateTime   @default(now())
  endAt             DateTime   @default(now())
  playSeconds       Int        @default(0)
}
